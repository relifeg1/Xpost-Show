<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <title>Tweet Overlay</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Cairo', sans-serif;
        }

        #container {
            display: none;
            position: absolute;
            bottom: 50px;
            right: 50px;
            width: 500px;
            /* Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª Ù„Ù„ØªØ­ÙƒÙ… */
            transition: all 0.5s ease;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…ÙŠØ¯ÙŠØ§ Ø§Ù„Ø¹Ø§Ù… Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ø·ÙˆÙ„ÙŠØ© */
        .media img,
        .media video {
            width: 100%;
            border-radius: 12px;
            margin-top: 10px;
            /* ğŸ”¥ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù‡Ùˆ Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø­Ø±ÙŠ Ù„Ù„Ù…ÙŠØ¯ÙŠØ§ Ø§Ù„Ø·ÙˆÙŠÙ„Ø© ğŸ”¥ */
            max-height: 450px;
            object-fit: contain;
            background: rgba(0, 0, 0, 0.05);
            /* Ø®Ù„ÙÙŠØ© Ø®ÙÙŠÙØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙˆØ±Ø© ØµØºÙŠØ±Ø© */
        }

        /* === 1. ÙƒÙ„Ø§Ø³ÙŠÙƒ (Ø§Ù„Ù…ÙØ¶Ù„ Ù„Ø¯ÙŠÙƒ) === */
        .style-classic .card {
            background: #fff;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            color: #000;
        }

        .style-classic .header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .style-classic .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-left: 12px;
        }

        .style-classic .name {
            font-weight: 800;
            font-size: 1.2rem;
        }

        .style-classic .username {
            color: #555;
            font-size: 1rem;
            direction: ltr;
        }

        .style-classic .text {
            font-size: 1.4rem;
            line-height: 1.4;
            white-space: pre-wrap;
        }

        .style-classic .date {
            color: #555;
            font-size: 0.9rem;
            margin-top: 10px;
            display: block;
        }

        /* === 2. Chunky (Ø§Ù„Ø¶Ø®Ù…) === */
        .style-chunky .card {
            background: #000;
            border: 4px solid #1d9bf0;
            border-radius: 20px;
            padding: 20px;
            color: #fff;
            box-shadow: 0 0 0 8px rgba(0, 0, 0, 0.5);
        }

        .style-chunky .header {
            display: flex;
            align-items: center;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .style-chunky .avatar {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            margin-left: 15px;
            border: 2px solid #fff;
        }

        .style-chunky .name {
            font-weight: 900;
            font-size: 1.5rem;
            color: #1d9bf0;
        }

        .style-chunky .username {
            display: none;
        }

        /* Ù†Ø®ÙÙŠ Ø§Ù„ÙŠÙˆØ²Ø± Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ù…Ø³Ø§Ø­Ø© */
        .style-chunky .text {
            font-size: 2rem;
            font-weight: 900;
            line-height: 1.2;
        }

        /* Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ù…ÙŠØ¯ÙŠØ§ ÙÙŠ Ø§Ù„Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø¶Ø®Ù… Ø£Ù„Ø§ ØªØ£Ø®Ø° Ù…Ø³Ø§Ø­Ø© ÙƒØ¨ÙŠØ±Ø© */
        .style-chunky .media img {
            border: 2px solid #333;
            max-height: 350px;
        }

        /* === 3. Bubble (Ø§Ù„ÙÙ‚Ø§Ø¹Ø©) === */
        .style-bubble .card {
            background: transparent;
        }

        .style-bubble .header {
            display: flex;
            align-items: center;
            margin-bottom: -15px;
            position: relative;
            z-index: 2;
        }

        .style-bubble .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid #fff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .style-bubble .name-badge {
            background: #1d9bf0;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-right: -15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .style-bubble .content-box {
            background: #fff;
            color: #000;
            padding: 20px 20px;
            border-radius: 20px;
            border-top-right-radius: 0;
            font-size: 1.3rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-top: 5px;
            font-weight: 600;
        }

        /* === 4. Minimal === */
        .style-minimal .card {
            background: rgba(0, 0, 0, 0.8);
            border-right: 6px solid #1d9bf0;
            padding: 15px;
            color: white;
            border-radius: 8px;
            backdrop-filter: blur(5px);
        }

        .style-minimal .header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .style-minimal .avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .style-minimal .name {
            font-weight: bold;
            color: #ddd;
        }

        .style-minimal .text {
            font-size: 1.5rem;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <div id="container"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const container = document.getElementById('container');

        function renderTweet(data, settings) {
            const theme = settings.theme || 'classic';
            container.className = `style-${theme}`;

            // 1. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…ÙŠØ¯ÙŠØ§ (ØµÙˆØ±/ÙÙŠØ¯ÙŠÙˆ)
            let mediaHtml = '';
            if (settings.showMedia && data.mediaDetails && data.mediaDetails.length > 0) {
                // Ù†Ø£Ø®Ø° Ø£ÙˆÙ„ Ù…ÙŠØ¯ÙŠØ§ ÙÙ‚Ø· Ù„Ù„Ø¹Ø±Ø¶
                mediaHtml = `<div class="media"><img src="${data.mediaDetails[0].media_url_https}"></div>`;
            }

            // 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø·
            const formattedText = data.text.replace(/(https?:\/\/[^\s]+)/g, '');

            // 3. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‡ÙŠØ¯Ø± (ØµÙˆØ±Ø© + Ø§Ø³Ù… + ÙŠÙˆØ²Ø±)
            let headerHtml = '';
            if (settings.showAvatar || settings.showName || settings.showUsername) {
                headerHtml += `<div class="header">`;
                if (settings.showAvatar) headerHtml += `<img class="avatar" src="${data.user.profile_image_url_https.replace('_normal', '')}">`;
                headerHtml += `<div>`;
                if (settings.showName) headerHtml += `<div class="name">${data.user.name}</div>`;
                if (settings.showUsername) headerHtml += `<div class="username">@${data.user.screen_name}</div>`;
                headerHtml += `</div>`;
                // Ø¥Ø¶Ø§ÙØ© Ø®Ø§ØµØ© Ù„Ø«ÙŠÙ… Ø§Ù„ÙÙ‚Ø§Ø¹Ø©
                if (theme === 'bubble' && settings.showName) headerHtml += `<div class="name-badge">${data.user.name}</div>`;
                headerHtml += `</div>`;
            }

            // 4. Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ°ÙŠÙŠÙ„ (Ø§Ù„ØªØ§Ø±ÙŠØ®)
            let footerHtml = '';
            if (settings.showDate) {
                const dateStr = new Date(data.created_at).toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
                footerHtml = `<span class="date">${dateStr}</span>`;
            }

            // 5. ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ø«ÙŠÙ…
            let html = '';

            if (theme === 'bubble') {
                // Ø«ÙŠÙ… Ø§Ù„ÙÙ‚Ø§Ø¹Ø© Ù„Ù‡ Ù‡ÙŠÙƒÙ„ Ø®Ø§Øµ
                html = `
                    <div class="card animate__animated animate__fadeInUp">
                        ${settings.showAvatar ? `<div class="header"><img class="avatar" src="${data.user.profile_image_url_https}"> ${settings.showName ? `<div class="name-badge">${data.user.name}</div>` : ''}</div>` : ''}
                        <div class="content-box">
                            <div class="text">${formattedText}</div>
                            ${mediaHtml}
                            ${footerHtml}
                        </div>
                    </div>
                `;
            } else {
                // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø«ÙŠÙ…Ø§Øª (ÙƒÙ„Ø§Ø³ÙŠÙƒØŒ ØªØ´Ø§Ù†ÙƒÙŠØŒ Ù…ÙŠÙ†ÙŠÙ…Ø§Ù„)
                html = `
                    <div class="card animate__animated animate__fadeInUp">
                        ${headerHtml}
                        <div class="text">${formattedText}</div>
                        ${mediaHtml}
                        ${footerHtml}
                    </div>
                `;
            }

            container.innerHTML = html;
            container.style.display = 'block';
        }

        socket.on('show_tweet', (msg) => {
            renderTweet(msg.data, msg.settings);
        });

        socket.on('hide_tweet', () => {
            container.style.display = 'none';
        });

        // ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØªØºØ±ÙŠØ¯Ø© Ù…Ø¹Ø±ÙˆØ¶Ø©
        socket.on('state_update', (state) => {
            // Ù…ÙŠØ²Ø© Ø¥Ø¶Ø§ÙÙŠØ©: Ù„Ùˆ Ø£Ø±Ø¯Øª ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØºØ±ÙŠØ¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø¶ØºØ· Checkbox ÙŠÙ…ÙƒÙ†Ùƒ ØªÙØ¹ÙŠÙ„ Ù‡Ø°Ø§
            // Ù„ÙƒÙ† Ø³Ù†ÙƒØªÙÙŠ Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ù„ÙŠ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø±Ù…Ø´
        });
    </script>
</body>

</html>