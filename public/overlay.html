<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <title>Tweet Overlay</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* إعدادات أساسية */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Cairo', sans-serif;
        }

        #container {
            display: none;
            /* مخفي افتراضياً */
            position: absolute;
            bottom: 50px;
            right: 50px;
            /* مكان الظهور */
            width: 600px;
            /* عرض ثابت لنتحكم فيه من OBS */
            transition: all 0.5s ease;
        }

        /* ====================
           1. الثيم الكلاسيكي (Classic)
           ==================== */
        .style-classic .card {
            background: #ffffff;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            color: #000;
        }

        .style-classic .header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .style-classic .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-left: 15px;
        }

        .style-classic .name {
            font-weight: 800;
            font-size: 1.4rem;
        }

        .style-classic .username {
            color: #555;
            font-size: 1.1rem;
        }

        .style-classic .text {
            font-size: 1.8rem;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .style-classic .media img {
            width: 100%;
            border-radius: 15px;
            margin-top: 10px;
        }

        /* ====================
           2. ثيم "الضخم" (Chunky) - الأفضل للتصغير
           ==================== */
        .style-chunky .card {
            background: #000000;
            border: 4px solid #1d9bf0;
            border-radius: 30px;
            padding: 30px;
            color: #fff;
            box-shadow: 0 0 0 10px rgba(0, 0, 0, 0.5);
            /* إطار وهمي لزيادة التباين */
        }

        .style-chunky .header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }

        .style-chunky .avatar {
            width: 80px;
            height: 80px;
            border-radius: 15px;
            margin-left: 20px;
            border: 3px solid #fff;
        }

        .style-chunky .name {
            font-weight: 900;
            font-size: 2rem;
            color: #1d9bf0;
        }

        .style-chunky .username {
            display: none;
            /* نخفي اليوزر لتقليل الزحمة */
        }

        /* خط ضخم جداً ليقاوم التصغير */
        .style-chunky .text {
            font-size: 2.8rem;
            font-weight: 900;
            line-height: 1.2;
            margin-bottom: 20px;
        }

        .style-chunky .media img {
            width: 100%;
            border-radius: 20px;
            border: 2px solid #333;
        }

        .style-chunky .footer {
            display: none;
            /* نخفي التاريخ */
        }

        /* ====================
           3. ثيم "الفقاعة" (Bubble)
           ==================== */
        .style-bubble .card {
            background: transparent;
        }

        .style-bubble .header {
            display: flex;
            align-items: center;
            margin-bottom: -10px;
            position: relative;
            z-index: 2;
        }

        .style-bubble .avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 4px solid #fff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .style-bubble .name-box {
            background: #1d9bf0;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            margin-right: -20px;
            font-weight: bold;
        }

        .style-bubble .text-box {
            background: #fff;
            color: #000;
            padding: 25px 30px 25px 30px;
            border-radius: 0 30px 30px 30px;
            font-size: 1.8rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-top: 10px;
            font-weight: 700;
        }

        .style-bubble .media img {
            border-radius: 20px;
            margin-top: 15px;
            width: 100%;
        }

        /* ====================
           4. ثيم "مينيمال" (Minimal)
           ==================== */
        .style-minimal .card {
            background: linear-gradient(90deg, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.6) 100%);
            border-left: 10px solid #1d9bf0;
            padding: 20px;
            color: white;
            border-radius: 5px;
        }

        .style-minimal .header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .style-minimal .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .style-minimal .name {
            font-weight: bold;
            font-size: 1.2rem;
            color: #ddd;
        }

        .style-minimal .username {
            display: none;
        }

        .style-minimal .text {
            font-size: 2rem;
            font-weight: 600;
            text-shadow: 2px 2px 4px #000;
        }

        .style-minimal .media img {
            width: 100%;
            border-radius: 5px;
            margin-top: 10px;
        }
    </style>
</head>

<body>

    <div id="container">
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const container = document.getElementById('container');

        // دالة لبناء HTML بناءً على الثيم المختار
        function renderTweet(data, settings) {
            const theme = settings.theme || 'classic'; // الثيم الافتراضي
            container.className = `style-${theme}`; // تطبيق كلاس CSS

            let mediaHtml = '';
            if (data.mediaDetails && data.mediaDetails.length > 0) {
                mediaHtml = `<div class="media"><img src="${data.mediaDetails[0].media_url_https}" ></div>`;
            }

            // HTML الهيكل العام
            let html = `
                <div class="card animate__animated animate__fadeInUp">
                    <div class="header">
                        <img class="avatar" src="${data.user.profile_image_url_https.replace('_normal', '')}">
                        <div>
                            <div class="name">${data.user.name}</div>
                            <div class="username">@${data.user.screen_name}</div>
                        </div>
                        ${theme === 'bubble' ? `<div class="name-box">${data.user.name}</div>` : ''} 
                    </div>
                    
                    ${theme === 'bubble' ? `<div class="text-box">${formatText(data.text)} ${mediaHtml}</div>` :
                    `<div class="text">${formatText(data.text)}</div> ${mediaHtml}`}
                    
                    <div class="footer">
                        ${theme === 'chunky' ? '' : `<span class="date">${new Date(data.created_at).toLocaleTimeString('ar-SA')}</span>`}
                    </div>
                </div>
            `;

            // تعديل بسيط لثيم Bubble (إخفاء الهيدر العادي)
            if (theme === 'bubble') {
                html = html.replace('<div class="name">', '<div class="name" style="display:none">');
                html = html.replace('<div class="username">', '<div class="username" style="display:none">');
            }

            container.innerHTML = html;
            container.style.display = 'block';
        }

        function formatText(text) {
            return text.replace(/(https?:\/\/[^\s]+)/g, ''); // إخفاء الروابط
        }

        socket.on('show_tweet', (msg) => {
            renderTweet(msg.data, msg.settings);
        });

        socket.on('hide_tweet', () => {
            container.style.display = 'none';
        });

        // تحديث الثيم فوراً إذا تغير من الأدمن
        socket.on('state_update', (state) => {
            // إذا كان هناك تغريدة معروضة حالياً، أعد رسمها بالثيم الجديد
            if (container.style.display === 'block' && state.queue[state.current]) {
                // نستخدم التغريدة الحالية من الذاكرة إذا أمكن، أو ننتظر الحدث القادم
                // هنا سنكتفي بتحديث المتغيرات العامة
            }
        });

    </script>
</body>

</html>