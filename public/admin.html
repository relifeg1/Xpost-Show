<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ZairuDuo Controller ğŸ®</title>
    <style>
      body {
        background: #121212;
        color: white;
        font-family: "Segoe UI", sans-serif;
        padding: 20px;
      }
      .container {
        max-width: 600px;
        margin: auto;
      }
      input,
      button,
      select {
        width: 100%;
        padding: 12px;
        margin: 5px 0;
        border-radius: 8px;
        border: none;
        font-size: 16px;
      }
      input {
        background: #333;
        color: white;
      }
      button {
        cursor: pointer;
        font-weight: bold;
      }
      .btn-add {
        background: #1d9bf0;
        color: white;
      }
      .btn-control {
        background: #00ba7c;
        color: white;
        width: 48%;
        display: inline-block;
      }
      .btn-hide {
        background: #f91880;
        color: white;
      }
      .tweet-item {
        background: #1e1e1e;
        padding: 15px;
        margin: 10px 0;
        border-radius: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .status-bar {
        background: #2f3336;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 20px;
        text-align: center;
      }

      /* ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø«ÙŠÙ…Ø§Øª */
      select {
        background: #444;
        color: #fff;
        border: 2px solid #555;
        cursor: pointer;
      }
      label {
        display: block;
        margin-top: 10px;
        color: #aaa;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>ğŸ›ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… ZairuDuo</h2>

      <div class="status-bar">
        <span id="statusText">Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„...</span>
        <div
          id="currentThemeDisplay"
          style="font-size: 12px; color: #1d9bf0; margin-top: 5px"
        ></div>
      </div>

      <div
        style="
          background: #191919;
          padding: 15px;
          border-radius: 10px;
          margin-bottom: 15px;
          border: 1px solid #333;
        "
      >
        <label>ğŸ¨ Ø§Ø®ØªØ± ØªØµÙ…ÙŠÙ… Ø§Ù„ØªØºØ±ÙŠØ¯Ø©:</label>
        <select id="themeSelector" onchange="updateSettings()">
          <option value="classic">ÙƒÙ„Ø§Ø³ÙŠÙƒ (ØªÙˆÙŠØªØ± Ø§Ù„Ø±Ø³Ù…ÙŠ)</option>
          <option value="chunky">Ø§Ù„Ø¶Ø®Ù… (Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø©) ğŸ”¥</option>
          <option value="bubble">Ø§Ù„ÙÙ‚Ø§Ø¹Ø© (Bubble)</option>
          <option value="minimal">Ù…ÙŠÙ†ÙŠÙ…Ø§Ù„ (Ø´ÙØ§Ù ÙˆØ¨Ø³ÙŠØ·)</option>
        </select>
      </div>

      <input
        type="text"
        id="tweetUrl"
        placeholder="Ø§Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØºØ±ÙŠØ¯Ø© Ù‡Ù†Ø§..."
      />
      <button class="btn-add" onclick="addTweet()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© â•</button>

      <div style="margin-top: 15px">
        <button class="btn-control" onclick="control('prev')">â®ï¸ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <button class="btn-control" onclick="control('next')">Ø§Ù„ØªØ§Ù„ÙŠ â­ï¸</button>
      </div>
      <button
        class="btn-control"
        style="width: 100%; margin-top: 5px; background: #e6b800"
        onclick="control('toggle_auto')"
      >
        ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ â¯ï¸
      </button>
      <button
        class="btn-hide"
        style="width: 100%; margin-top: 5px"
        onclick="control('hide')"
      >
        Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØºØ±ÙŠØ¯Ø© ğŸ‘ï¸
      </button>

      <h3>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (<span id="count">0</span>)</h3>
      <div id="queueList"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      let currentSettings = {};

      socket.on("state_update", (state) => {
        document.getElementById("count").innerText = state.queue.length;
        document.getElementById("statusText").innerText = state.isAuto
          ? "âœ… Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙŠØ¹Ù…Ù„"
          : "â¸ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ";

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        const list = document.getElementById("queueList");
        list.innerHTML = "";
        state.queue.forEach((t, i) => {
          const div = document.createElement("div");
          div.className = "tweet-item";
          div.style.border = i === state.current ? "2px solid #1d9bf0" : "none";
          div.innerHTML = `
                    <div style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 70%;">
                        ${i + 1}. ${t.text || "ØµÙˆØ±Ø©/ÙÙŠØ¯ÙŠÙˆ"}
                    </div>
                    <div>
                        <button onclick="control('show', ${i})" style="width:auto; padding:5px 10px;">â–¶ï¸</button>
                        <button onclick="manage('delete', ${i})" style="width:auto; padding:5px 10px; background:#f00;">ğŸ—‘ï¸</button>
                    </div>
                `;
          list.appendChild(div);
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø«ÙŠÙ… ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        if (state.settings && state.settings.theme) {
          currentSettings = state.settings;
          document.getElementById("themeSelector").value = state.settings.theme;
          document.getElementById("currentThemeDisplay").innerText =
            `Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ: ${state.settings.theme}`;
        }
      });

      function addTweet() {
        const url = document.getElementById("tweetUrl").value;
        fetch("/api/add", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url }),
        }).then(() => (document.getElementById("tweetUrl").value = ""));
      }

      function control(action, index) {
        fetch("/api/control", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action, index }),
        });
      }

      function manage(action, index) {
        fetch("/api/manage", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action, index }),
        });
      }

      function updateSettings() {
        const theme = document.getElementById("themeSelector").value;
        fetch("/api/settings", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ theme }),
        });
      }
    </script>
  </body>
</html>
