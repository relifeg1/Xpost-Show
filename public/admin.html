<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZairuDuo Studio ğŸ™ï¸</title>
    <style>
        body { background: #0f0f0f; color: #e0e0e0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; max-width: 900px; margin: auto; }
        
        /* Layout Grid */
        .main-grid { display: grid; grid-template-columns: 1fr 300px; gap: 20px; }
        @media (max-width: 768px) { .main-grid { grid-template-columns: 1fr; } }

        /* Generic Styles */
        input, select, button, textarea { padding: 10px; border-radius: 6px; border: 1px solid #333; background: #222; color: white; margin: 5px 0; font-size: 14px; width: 100%; box-sizing: border-box; }
        button { cursor: pointer; font-weight: bold; transition: 0.2s; border: none; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        
        .box { background: #1a1a1a; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #333; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .section-title { margin: 0 0 10px 0; font-size: 14px; color: #888; text-transform: uppercase; letter-spacing: 1px; }

        /* Tabs */
        .tabs { display: flex; gap: 5px; margin-bottom: 10px; }
        .tab-btn { background: #333; color: #aaa; flex: 1; border-bottom: 2px solid transparent; border-radius: 6px 6px 0 0; }
        .tab-btn.active { background: #1d9bf0; color: white; border-bottom: 2px solid white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Specific Buttons */
        .btn-add { background: linear-gradient(45deg, #1d9bf0, #00ba7c); }
        .btn-control { background: #333; border: 1px solid #555; }
        .btn-active-auto { background: #00ba7c; color: white; animation: pulse 2s infinite; }
        
        /* Queue Item */
        .tweet-item { background: #1e1e1e; padding: 10px; margin-bottom: 8px; border-radius: 8px; border-right: 4px solid #333; transition: all 0.3s; }
        .tweet-item.active { border-right-color: #1d9bf0; background: #252a30; }
        .tweet-item.pinned { border-right-color: #e6b800; }
        .tweet-item.breaking { border-right-color: #f91880; background: rgba(249, 24, 128, 0.1); }

        .item-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 5px; }
        .controls-row { display: flex; gap: 5px; }
        .mini-btn { padding: 4px 8px; font-size: 12px; width: auto; }

        /* Preview Iframe */
        .preview-container { width: 100%; height: 168px; overflow: hidden; position: relative; background: url('https://abs.twimg.com/sticky/default_profile_images/default_profile_normal.png'); background-size: cover; border-radius: 8px; border: 2px solid #333; }
        iframe { width: 1280px; height: 720px; border: none; transform: scale(0.234); transform-origin: top left; pointer-events: none; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="main-grid">
    <div>
        <div class="box" style="display:flex; justify-content:space-between; align-items:center;">
            <div><span id="statusIcon">âšª</span> <span id="statusText">...</span></div>
            <div style="display:flex; gap:10px; align-items:center;">
                <label><input type="checkbox" id="playSound" onchange="updateSettings()" style="width:auto;"> ğŸ”Š ØµÙˆØª</label>
                <input type="number" id="globalTimer" value="15" style="width:50px; text-align:center;" onchange="updateSettings()" title="Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„Ø¹Ø§Ù…">
            </div>
        </div>

        <div class="box" style="border-top: 3px solid #1d9bf0;">
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('link')">ğŸ”— Ø±Ø§Ø¨Ø· ØªÙˆÙŠØªØ±</button>
                <button class="tab-btn" onclick="switchTab('custom')">âœï¸ Ø¨Ø·Ø§Ù‚Ø© Ù…Ø®ØµØµØ©</button>
            </div>

            <div id="tab-link" class="tab-content active">
                <input type="text" id="tweetUrl" placeholder="https://x.com/..." autofocus>
            </div>

            <div id="tab-custom" class="tab-content">
                <input type="text" id="customTitle" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ù…Ø«Ù„Ø§Ù‹: Ø®Ø¨Ø± Ø¹Ø§Ø¬Ù„)">
                <textarea id="customText" rows="2" placeholder="Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ø®Ø¨Ø± Ù‡Ù†Ø§..."></textarea>
                <input type="text" id="customImage" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                <input type="text" id="customMedia" placeholder="Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ/ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            </div>

            <div style="display:flex; gap:5px; margin-top:10px;">
                <select id="addTheme" style="flex:1;">
                    <option value="classic">ÙƒÙ„Ø§Ø³ÙŠÙƒ</option>
                    <option value="chunky">Ø¶Ø®Ù… (Chunky)</option>
                    <option value="bubble">ÙÙ‚Ø§Ø¹Ø©</option>
                    <option value="minimal">Ù…ÙŠÙ†ÙŠÙ…Ø§Ù„</option>
                </select>
                <input type="number" id="addDuration" placeholder="ÙˆÙ‚Øª(Ø«)" style="width:70px; text-align:center;">
            </div>
            <button class="btn-add" onclick="addItem()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© â•</button>
        </div>

        <h3 class="section-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ (<span id="count">0</span>)</h3>
        <div id="queueList"></div>
    </div>

    <div>
        <div class="box">
            <h4 class="section-title">ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨Ø« (Live)</h4>
            <div class="preview-container">
                <iframe src="/overlay.html" scrolling="no"></iframe>
            </div>
        </div>

        <div class="box">
            <h4 class="section-title">ğŸ® Ø§Ù„ØªØ­ÙƒÙ…</h4>
            <div style="display:flex; gap:5px;">
                <button class="btn-control" onclick="api('control', {action:'prev'})">â®ï¸</button>
                <button class="btn-control" onclick="api('control', {action:'next'})">â­ï¸</button>
            </div>
            <button id="btnAuto" class="btn-control" style="width:100%; margin-top:5px;" onclick="api('control', {action:'toggle_auto'})">ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ â¯ï¸</button>
            <button class="btn-control" style="width:100%; margin-top:5px; background:#f91880; color:white;" onclick="api('control', {action:'hide'})">Ø¥Ø®ÙØ§Ø¡ Ù†Ù‡Ø§Ø¦ÙŠ â¹ï¸</button>
        </div>

        <div class="box">
            <h4 class="section-title">âš™ï¸ Ø¸Ù‡ÙˆØ± Ø§Ù„Ø¹Ù†Ø§ØµØ±</h4>
            <label><input type="checkbox" id="showAvatar" onchange="updateSettings()" style="width:auto;"> ØµÙˆØ±Ø©</label>
            <label><input type="checkbox" id="showName" onchange="updateSettings()" style="width:auto;"> Ø§Ø³Ù…</label>
            <label><input type="checkbox" id="showMedia" onchange="updateSettings()" style="width:auto;"> Ù…ÙŠØ¯ÙŠØ§</label>
            <label><input type="checkbox" id="showDate" onchange="updateSettings()" style="width:auto;"> ØªØ§Ø±ÙŠØ®</label>
        </div>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    let currentMode = 'link';

    function switchTab(mode) {
        currentMode = mode;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelector(`.tab-btn[onclick="switchTab('${mode}')"]`).classList.add('active');
        document.getElementById(`tab-${mode}`).classList.add('active');
    }

    socket.on('state_update', (state) => {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
        document.getElementById('count').innerText = state.queue.length;
        document.getElementById('statusText').innerText = state.isAuto ? "ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙŠØ¹Ù…Ù„" : "ÙŠØ¯ÙˆÙŠ";
        document.getElementById('statusIcon').innerText = state.isAuto ? "ğŸŸ¢" : "â¸ï¸";
        
        const btnAuto = document.getElementById('btnAuto');
        if(state.isAuto) btnAuto.classList.add('btn-active-auto'); else btnAuto.classList.remove('btn-active-auto');

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        if(state.settings) {
            document.getElementById('showAvatar').checked = state.settings.showAvatar;
            document.getElementById('showName').checked = state.settings.showName;
            document.getElementById('showMedia').checked = state.settings.showMedia;
            document.getElementById('showDate').checked = state.settings.showDate;
            document.getElementById('playSound').checked = state.settings.playSound;
            document.getElementById('globalTimer').value = state.settings.defaultDuration || 15;
        }

        // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        const list = document.getElementById('queueList');
        list.innerHTML = '';
        state.queue.forEach((t, i) => {
            const div = document.createElement('div');
            const isPinned = t.customSettings?.pinned;
            const isBreaking = t.customSettings?.breaking;
            
            div.className = `tweet-item ${i === state.current ? 'active' : ''} ${isPinned ? 'pinned' : ''} ${isBreaking ? 'breaking' : ''}`;
            
            div.innerHTML = `
                <div class="item-row">
                    <div style="flex:1; font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                        <b>#${i+1}</b> ${t.text || 'Ù…Ø­ØªÙˆÙ‰ Ù…ÙŠØ¯ÙŠØ§'}
                    </div>
                    ${isPinned ? 'ğŸ“Œ' : ''} ${isBreaking ? 'ğŸš¨' : ''}
                </div>
                <div class="controls-row">
                    <button class="mini-btn" style="background:#1d9bf0; flex:1;" onclick="api('control', {action:'show', index:${i}})">Ø¹Ø±Ø¶ â–¶ï¸</button>
                    <button class="mini-btn" style="background:${isPinned?'#e6b800':'#333'}" onclick="editItem(${i}, 'togglePin', true)" title="ØªØ«Ø¨ÙŠØª (ÙŠÙˆÙ‚Ù Ø§Ù„Ù…Ø¤Ù‚Øª)">ğŸ“Œ</button>
                    <button class="mini-btn" style="background:${isBreaking?'#f91880':'#333'}" onclick="editItem(${i}, 'toggleBreaking', true)" title="Ø®Ø¨Ø± Ø¹Ø§Ø¬Ù„">ğŸš¨</button>
                    <button class="mini-btn" style="background:#f00;" onclick="api('manage', {action:'delete', index:${i}})">ğŸ—‘ï¸</button>
                </div>
            `;
            list.appendChild(div);
        });
    });

    function addItem() {
        const theme = document.getElementById('addTheme').value;
        const duration = document.getElementById('addDuration').value;

        let payload = { mode: currentMode, theme, duration };

        if (currentMode === 'link') {
            payload.url = document.getElementById('tweetUrl').value;
        } else {
            payload.title = document.getElementById('customTitle').value;
            payload.text = document.getElementById('customText').value;
            payload.image = document.getElementById('customImage').value;
            payload.mediaUrl = document.getElementById('customMedia').value;
        }

        fetch('/api/add', {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
        }).then(() => {
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
            if(currentMode==='link') document.getElementById('tweetUrl').value = '';
            else {
                document.getElementById('customTitle').value = '';
                document.getElementById('customText').value = '';
            }
        });
    }

    function api(endpoint, data) {
        fetch(endpoint === 'manage' ? '/api/manage' : '/api/control', {
            method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data)
        });
    }

    function editItem(index, actionType, val) {
        fetch('/api/edit_tweet', {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ index, [actionType]: val })
        });
    }

    function updateSettings() {
        const settings = {
            showAvatar: document.getElementById('showAvatar').checked,
            showName: document.getElementById('showName').checked,
            showMedia: document.getElementById('showMedia').checked,
            showDate: document.getElementById('showDate').checked,
            playSound: document.getElementById('playSound').checked,
            defaultDuration: parseInt(document.getElementById('globalTimer').value) || 15
        };
        fetch('/api/settings', {
            method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(settings)
        });
    }
</script>
</body>
</html>